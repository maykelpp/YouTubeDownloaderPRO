
<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>YouTube Downloader PRO - 100% GRATIS</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:#0a0a0a;color:#fff;padding:20px;padding-bottom:140px}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(circle at 30% 50%,rgba(16,185,129,0.12),transparent 50%),radial-gradient(circle at 70% 50%,rgba(59,130,246,0.12),transparent 50%);z-index:0;pointer-events:none;animation:pulse 8s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.container{max-width:1400px;margin:0 auto;position:relative;z-index:1}

.top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding:20px;background:rgba(30,30,30,0.95);backdrop-filter:blur(20px);border-radius:20px;border:1px solid rgba(255,255,255,0.1);flex-wrap:wrap;gap:15px}
.free-badge{padding:12px 24px;background:linear-gradient(135deg,#10b981,#3b82f6);border-radius:50px;font-weight:700;font-size:15px;display:flex;align-items:center;gap:8px;box-shadow:0 4px 20px rgba(16,185,129,0.4)}
.stats-global{display:flex;gap:20px;font-size:13px;color:#aaa;flex-wrap:wrap}
.stat-item{display:flex;align-items:center;gap:6px;padding:8px 16px;background:rgba(255,255,255,0.05);border-radius:50px}
.stat-number{color:#10b981;font-weight:700}

.header{text-align:center;padding:60px 30px;background:linear-gradient(135deg,#10b981,#3b82f6);border-radius:24px;margin-bottom:40px;box-shadow:0 20px 60px rgba(16,185,129,0.3);position:relative;overflow:hidden}
.header::before{content:'';position:absolute;inset:0;background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="rgba(255,255,255,0.05)"/></svg>');opacity:0.3}
h1{font-size:clamp(32px,5vw,56px);margin-bottom:15px;font-weight:900;position:relative}
.subtitle{font-size:18px;opacity:0.95;margin-bottom:20px;position:relative}
.free-tag{display:inline-block;padding:10px 30px;background:rgba(255,255,255,0.2);border-radius:50px;font-weight:700;font-size:14px;margin-top:10px;backdrop-filter:blur(10px)}

.donation-banner{background:linear-gradient(135deg,rgba(234,179,8,0.15),rgba(234,88,12,0.15));border:2px solid rgba(234,179,8,0.3);border-radius:20px;padding:25px;margin-bottom:30px;display:flex;align-items:center;justify-content:space-between;gap:20px;flex-wrap:wrap}
.donation-text{flex:1}
.donation-title{font-size:20px;font-weight:700;margin-bottom:8px;color:#fbbf24}
.donation-desc{font-size:14px;color:#d1d5db}
.donate-btn{padding:14px 32px;background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:15px;transition:all 0.3s;font-family:'Poppins',sans-serif;box-shadow:0 4px 15px rgba(251,191,36,0.4)}
.donate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(251,191,36,0.6)}

.search-box{background:rgba(30,30,30,0.95);backdrop-filter:blur(30px);border-radius:20px;padding:30px;margin-bottom:40px;border:1px solid rgba(255,255,255,0.1)}
.search-input{width:100%;padding:18px 24px;border:2px solid rgba(255,255,255,0.15);border-radius:50px;font-size:16px;background:rgba(10,10,10,0.8);color:#fff;margin-bottom:20px;transition:all 0.3s;outline:none;font-family:'Poppins',sans-serif}
.search-input:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.2)}
.btn{padding:16px 40px;border:none;border-radius:50px;background:linear-gradient(135deg,#10b981,#3b82f6);color:#fff;font-weight:700;cursor:pointer;font-size:16px;transition:all 0.3s;font-family:'Poppins',sans-serif;width:100%;box-shadow:0 4px 20px rgba(16,185,129,0.4)}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 30px rgba(16,185,129,0.6)}

.results-info{text-align:center;color:#aaa;font-size:15px;margin:25px 0}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px;margin-top:30px}
.card{background:rgba(30,30,30,0.95);backdrop-filter:blur(20px);border-radius:20px;overflow:hidden;transition:all 0.4s;border:1px solid rgba(255,255,255,0.1);cursor:pointer}
.card:hover{transform:translateY(-8px);box-shadow:0 20px 50px rgba(16,185,129,0.3);border-color:rgba(16,185,129,0.5)}

.thumbnail-wrapper{position:relative;background:#000;padding-bottom:56.25%;overflow:hidden}
.thumbnail{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:transform 0.4s}
.card:hover .thumbnail{transform:scale(1.05)}
.play-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s}
.card:hover .play-overlay{opacity:1}
.play-icon{width:60px;height:60px;background:#10b981;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(16,185,129,0.5)}
.play-icon svg{width:28px;height:28px;fill:#fff;margin-left:3px}
.duration-badge{position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,0.8);padding:4px 10px;border-radius:6px;font-size:12px;font-weight:600}
.views-badge{position:absolute;top:10px;left:10px;background:rgba(0,0,0,0.8);padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;display:flex;align-items:center;gap:4px}

.card-content{padding:20px}
.video-title{font-weight:600;font-size:15px;margin-bottom:10px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.4;min-height:42px}
.channel{font-size:13px;color:#aaa;margin-bottom:15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

.actions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.action-btn{padding:12px;border:none;border-radius:12px;font-weight:600;cursor:pointer;font-size:13px;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:'Poppins',sans-serif}
.action-btn svg{width:18px;height:18px;flex-shrink:0}
.download-audio{background:linear-gradient(135deg,#10b981,#3b82f6);color:#fff}
.download-audio:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(16,185,129,0.5)}
.download-video{background:rgba(255,255,255,0.1);color:#fff;border:1px solid rgba(255,255,255,0.2)}
.download-video:hover{background:rgba(255,255,255,0.15);transform:translateY(-2px)}
.action-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}

.info-btn{grid-column:1/-1;background:rgba(255,255,255,0.05);color:#fff;border:1px solid rgba(255,255,255,0.1)}
.info-btn:hover{background:rgba(255,255,255,0.08)}

.loading{text-align:center;padding:60px 20px;color:#aaa}
.spinner{width:60px;height:60px;margin:0 auto 20px;border:4px solid rgba(255,255,255,0.1);border-top-color:#10b981;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.modal{position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:2000;padding:20px}
.modal-content{background:rgba(30,30,30,0.98);border-radius:24px;padding:40px;max-width:500px;width:100%;border:1px solid rgba(255,255,255,0.15);max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-title{font-size:24px;font-weight:700}
.close-modal{background:none;border:none;color:#fff;font-size:28px;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:background 0.3s}
.close-modal:hover{background:rgba(255,255,255,0.1)}

.download-progress{margin:20px 0}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;background:#10b981;border-radius:3px;width:0%;transition:width 0.5s}
.progress-text{text-align:center;margin-top:10px;color:#aaa;font-size:14px}

.video-info{background:rgba(0,0,0,0.4);padding:20px;border-radius:16px;margin-bottom:20px}
.info-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
.info-row:last-child{border:none}
.info-label{color:#aaa;font-size:13px}
.info-value{font-weight:600;font-size:14px}

.success-icon{width:80px;height:80px;margin:0 auto 20px;background:#10b981;border-radius:50%;display:flex;align-items:center;justify-content:center}
.success-icon svg{width:40px;height:40px;fill:#fff}

.footer{text-align:center;margin-top:60px;padding:30px;background:rgba(30,30,30,0.95);border-radius:20px;border:1px solid rgba(255,255,255,0.1)}
.footer-title{font-size:20px;font-weight:700;margin-bottom:15px;background:linear-gradient(135deg,#10b981,#3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.footer-text{color:#aaa;font-size:14px;margin-bottom:20px;line-height:1.6}
.social-links{display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
.social-btn{padding:12px 28px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:50px;color:#fff;text-decoration:none;font-weight:600;transition:all 0.3s;display:flex;align-items:center;gap:8px;font-size:14px}
.social-btn:hover{background:rgba(255,255,255,0.1);transform:translateY(-2px)}
.whatsapp{border-color:#25D366;color:#25D366}
.whatsapp:hover{background:rgba(37,211,102,0.2)}

@media(max-width:768px){
.grid{grid-template-columns:1fr;gap:16px}
.top-bar{flex-direction:column}
.donation-banner{flex-direction:column;text-align:center}
.actions{grid-template-columns:1fr}
}
</style></head><body>

<div class="container">
<div class="top-bar">
<div class="free-badge">
<svg style="width:24px;height:24px;fill:currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
100% GRATIS PARA TODOS
</div>
<div class="stats-global">
<div class="stat-item">
<svg style="width:16px;height:16px;fill:#10b981" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
<span><span class="stat-number">{{ stats.total }}</span> descargas totales</span>
</div>
<div class="stat-item">
<svg style="width:16px;height:16px;fill:#10b981" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
<span><span class="stat-number">{{ stats.today }}</span> hoy</span>
</div>
</div>
</div>

<div class="header">
<h1>üéµ YouTube Downloader PRO</h1>
<p class="subtitle">Descarga videos y m√∫sica en alta calidad - Sin l√≠mites, sin registro</p>
<div class="free-tag">üéâ SERVICIO GRATUITO üéâ</div>
</div>

<div class="donation-banner">
<div class="donation-text">
<div class="donation-title">üíö ¬øTe gusta este servicio?</div>
<div class="donation-desc">Este proyecto es y ser√° siempre gratis. Si quieres apoyarlo, puedes invitarme un caf√© ‚òï</div>
</div>
<button class="donate-btn" onclick="showDonation()">‚òï Apoyar el Proyecto</button>
</div>

<div class="search-box">
<input type="text" id="q" class="search-input" placeholder="üîç Buscar m√∫sica, videos, artistas..." onkeypress="if(event.key==='Enter')search()">
<button class="btn" onclick="search()">Buscar en YouTube</button>
</div>

<div class="results-info" id="resultsInfo" style="display:none"></div>
<div id="results"></div>

<div class="footer">
<div class="footer-title">üíé Hecho con amor para la comunidad</div>
<div class="footer-text">
Este servicio es completamente gratuito y siempre lo ser√°.<br>
Comp√°rtelo con quien lo necesite üíö
</div>
<div class="social-links">
<a href="https://wa.me/593979611678?text=Hola!%20Me%20encanta%20tu%20YouTube%20Downloader%20gratuito!" target="_blank" class="social-btn whatsapp">
<svg style="width:20px;height:20px" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
WhatsApp
</a>
<a href="#" onclick="showDonation();return false" class="social-btn">
<svg style="width:20px;height:20px;fill:currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
Donar
</a>
</div>
</div>
</div>

<div class="modal" id="infoModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title">üìä Informaci√≥n del Video</div>
<button class="close-modal" onclick="closeModal('infoModal')">&times;</button>
</div>
<div id="videoInfoContent"></div>
</div>
</div>

<div class="modal" id="downloadModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title" id="downloadTitle">‚è≥ Descargando...</div>
<button class="close-modal" onclick="closeModal('downloadModal')" id="closeDownload" style="display:none">&times;</button>
</div>
<div id="downloadContent">
<div class="download-progress">
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text" id="progressText">Iniciando descarga...</div>
</div>
</div>
</div>
</div>

<div class="modal" id="donationModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title">üíö Apoyar el Proyecto</div>
<button class="close-modal" onclick="closeModal('donationModal')">&times;</button>
</div>
<div style="text-align:center;padding:20px">
<div style="font-size:48px;margin-bottom:20px">‚òï</div>
<h3 style="font-size:22px;margin-bottom:15px">¬°Gracias por tu apoyo!</h3>
<p style="color:#aaa;font-size:15px;line-height:1.6;margin-bottom:25px">
Este proyecto es y siempre ser√° gratuito.<br>
Tu donaci√≥n ayuda a mantener el servidor y seguir mejorando el servicio para todos.
</p>
<div style="background:rgba(16,185,129,0.1);padding:20px;border-radius:16px;margin-bottom:20px;border:1px solid rgba(16,185,129,0.3)">
<p style="font-size:14px;color:#10b981;font-weight:600;margin-bottom:10px">üì± WhatsApp para donaciones:</p>
<p style="font-size:16px;font-weight:700">+593 979611678</p>
</div>
<p style="font-size:13px;color:#aaa;margin-bottom:20px">
üíö Cada aporte, por peque√±o que sea, hace la diferencia<br>
üåü Tu nombre puede aparecer en la lista de colaboradores
</p>
<a href="https://wa.me/593979611678?text=Hola!%20Quiero%20apoyar%20el%20proyecto%20YouTube%20Downloader%20con%20una%20donaci√≥n%20‚òïüíö" target="_blank" class="donate-btn" style="display:inline-block;text-decoration:none">
<svg style="width:20px;height:20px" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
Contactar por WhatsApp
</a>
</div>
</div>
</div>

<script>
let currentVideos=[];

async function search(){
const q=document.getElementById('q').value.trim();
if(!q)return;
document.getElementById('results').innerHTML='<div class="loading"><div class="spinner"></div><p>Buscando en YouTube...</p></div>';
document.getElementById('resultsInfo').style.display='none';

try{
const res=await fetch('/api/search',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:q})});
const data=await res.json();

if(data.error){
document.getElementById('results').innerHTML='<div class="loading"><p style="color:#ef4444">'+data.error+'</p></div>';
return;
}
showVideos(data);
}catch(e){
document.getElementById('results').innerHTML='<div class="loading"><p style="color:#ef4444">Error: '+e.message+'</p></div>';
}
}

function formatNumber(num){
if(num>=1000000)return(num/1000000).toFixed(1)+'M';
if(num>=1000)return(num/1000).toFixed(1)+'K';
return num;
}

function showVideos(data){
const videos=data.videos||[];
if(!videos.length){
document.getElementById('results').innerHTML='<div class="loading"><p>No se encontraron resultados</p></div>';
return;
}

currentVideos=videos;
document.getElementById('resultsInfo').textContent=`‚ú® ${videos.length} resultados encontrados - Todos disponibles gratis`;
document.getElementById('resultsInfo').style.display='block';

let html='<div class="grid">';
videos.forEach((video,idx)=>{
const m=Math.floor(video.duration/60);
const s=(video.duration%60).toString().padStart(2,'0');
const duration=video.duration>0?`${m}:${s}`:'En vivo';
const views=video.view_count?formatNumber(video.view_count)+' vistas':'';

html+=`<div class="card">
<div class="thumbnail-wrapper" onclick="showInfo(${idx})">
<img class="thumbnail" src="${video.thumbnail}" alt="${video.title}" loading="lazy">
<div class="play-overlay">
<div class="play-icon">
<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
</div>
</div>
<div class="duration-badge">${duration}</div>
${views?'<div class="views-badge"><svg style="width:12px;height:12px;fill:currentColor" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>'+views+'</div>':''}
</div>
<div class="card-content">
<div class="video-title">${video.title}</div>
<div class="channel">üë§ ${video.uploader}</div>
<div class="actions">
<button class="action-btn download-audio" onclick="downloadMedia(${idx},'audio')" id="audio-${idx}">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
Audio
</button>
<button class="action-btn download-video" onclick="downloadMedia(${idx},'video')" id="video-${idx}">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
Video
</button>
<button class="action-btn info-btn" onclick="showInfo(${idx})">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
Info completa
</button>
</div>
</div>
</div>`;
});
document.getElementById('results').innerHTML=html+'</div>';
}

async function showInfo(idx){
const video=currentVideos[idx];
const modal=document.getElementById('infoModal');
const content=document.getElementById('videoInfoContent');

content.innerHTML='<div class="loading"><div class="spinner"></div><p>Cargando informaci√≥n...</p></div>';
modal.style.display='flex';

try{
const res=await fetch('/api/video_info',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({video_id:video.id})
});
const data=await res.json();

if(data.success){
const info=data.info;
const m=Math.floor(info.duration/60);
const s=(info.duration%60).toString().padStart(2,'0');

content.innerHTML=`
<div style="text-align:center;margin-bottom:20px">
<img src="${info.thumbnail}" style="width:100%;border-radius:12px;margin-bottom:15px">
<h3 style="font-size:18px;margin-bottom:10px">${info.title}</h3>
<p style="color:#aaa;font-size:14px">üë§ ${info.uploader}</p>
</div>

<div class="video-info">
<div class="info-row">
<span class="info-label">‚è±Ô∏è Duraci√≥n</span>
<span class="info-value">${m}:${s}</span>
</div>
<div class="info-row">
<span class="info-label">üëÅÔ∏è Vistas</span>
<span class="info-value">${formatNumber(info.view_count)}</span>
</div>
<div class="info-row">
<span class="info-label">üëç Me gusta</span>
<span class="info-value">${formatNumber(info.like_count)}</span>
</div>
<div class="info-row">
<span class="info-label">üìÖ Subido</span>
<span class="info-value">${info.upload_date?info.upload_date.slice(0,4)+'/'+info.upload_date.slice(4,6)+'/'+info.upload_date.slice(6,8):'N/A'}</span>
</div>
<div class="info-row">
<span class="info-label">üìä Formatos</span>
<span class="info-value">${info.formats} disponibles</span>
</div>
</div>

${info.description?'<div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:12px;margin-top:15px;max-height:150px;overflow-y:auto"><p style="font-size:13px;color:#aaa;line-height:1.6;white-space:pre-wrap">'+info.description+'</p></div>':''}

<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:20px">
<button class="action-btn download-audio" onclick="closeModal('infoModal');downloadMedia(${idx},'audio')">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
Descargar Audio
</button>
<button class="action-btn download-video" onclick="closeModal('infoModal');downloadMedia(${idx},'video')">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
Descargar Video
</button>
</div>
`;
}else{
content.innerHTML='<div class="loading"><p style="color:#ef4444">Error al cargar informaci√≥n</p></div>';
}
}catch(e){
content.innerHTML='<div class="loading"><p style="color:#ef4444">'+e.message+'</p></div>';
}
}

async function downloadMedia(idx,type){
const video=currentVideos[idx];
const modal=document.getElementById('downloadModal');
const title=document.getElementById('downloadTitle');
const content=document.getElementById('downloadContent');
const fill=document.getElementById('progressFill');
const text=document.getElementById('progressText');
const closeBtn=document.getElementById('closeDownload');

const audioBtn=document.getElementById('audio-'+idx);
const videoBtn=document.getElementById('video-'+idx);
if(audioBtn)audioBtn.disabled=true;
if(videoBtn)videoBtn.disabled=true;

modal.style.display='flex';
closeBtn.style.display='none';
title.textContent=type==='audio'?'üéµ Descargando Audio...':'üé¨ Descargando Video...';
text.textContent='Preparando descarga gratuita...';
fill.style.width='10%';

try{
fill.style.width='30%';
text.textContent='Procesando con yt-dlp...';

const res=await fetch('/api/download',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({video_id:video.id,video_title:video.title,format_type:type})
});

fill.style.width='70%';
text.textContent='Finalizando...';

const data=await res.json();

if(data.success){
fill.style.width='100%';
text.textContent='';

content.innerHTML=`
<div class="success-icon">
<svg viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
</div>
<h3 style="text-align:center;font-size:20px;margin-bottom:10px">¬°Descarga completada!</h3>
<p style="text-align:center;color:#aaa;font-size:14px;margin-bottom:20px">${data.filename}</p>
<div style="background:rgba(16,185,129,0.1);padding:20px;border-radius:16px;margin-bottom:20px;border:1px solid rgba(16,185,129,0.3);text-align:center">
<p style="font-size:14px;color:#10b981;font-weight:600">üéâ Servicio 100% Gratuito</p>
<p style="font-size:13px;color:#aaa;margin-top:8px">Descarga todo lo que necesites, sin l√≠mites</p>
</div>
<div style="text-align:center;font-size:13px;color:#aaa">
<p>üíö Si te gusta este servicio, considera <a href="#" onclick="closeModal('downloadModal');showDonation();return false" style="color:#10b981;text-decoration:underline">apoyar el proyecto</a></p>
</div>
`;

closeBtn.style.display='block';
title.textContent='‚úÖ ¬°Listo!';

setTimeout(()=>{
window.location.href='/download/'+encodeURIComponent(data.filename);
},1000);

setTimeout(()=>{
modal.style.display='none';
if(audioBtn){
audioBtn.disabled=false;
audioBtn.innerHTML='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>‚úì';
}
if(videoBtn){
videoBtn.disabled=false;
videoBtn.innerHTML='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>‚úì';
}
},3000);
}else{
fill.style.width='0%';
content.innerHTML=`
<div style="text-align:center;padding:20px">
<div style="font-size:48px;margin-bottom:15px">‚ùå</div>
<h3 style="font-size:18px;color:#ef4444;margin-bottom:10px">Error en la descarga</h3>
<p style="color:#aaa;font-size:14px">${data.error}</p>
</div>
`;
closeBtn.style.display='block';
title.textContent='Error';

setTimeout(()=>{
modal.style.display='none';
if(audioBtn)audioBtn.disabled=false;
if(videoBtn)videoBtn.disabled=false;
},5000);
}
}catch(e){
fill.style.width='0%';
content.innerHTML=`
<div style="text-align:center;padding:20px">
<div style="font-size:48px;margin-bottom:15px">‚ùå</div>
<h3 style="font-size:18px;color:#ef4444;margin-bottom:10px">Error de conexi√≥n</h3>
<p style="color:#aaa;font-size:14px">${e.message}</p>
</div>
`;
closeBtn.style.display='block';
setTimeout(()=>{
modal.style.display='none';
if(audioBtn)audioBtn.disabled=false;
if(videoBtn)videoBtn.disabled=false;
},4000);
}
}

function showDonation(){
document.getElementById('donationModal').style.display='flex';
}

function closeModal(id){
document.getElementById(id).style.display='none';
}

document.getElementById('infoModal').addEventListener('click',e=>{
if(e.target.id==='infoModal')closeModal('infoModal');
});

document.getElementById('donationModal').addEventListener('click',e=>{
if(e.target.id==='donationModal')closeModal('donationModal');
});

window.addEventListener('load',()=>document.getElementById('q').focus());
</script>
</body></html>
